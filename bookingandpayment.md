# ğŸ¯ Ká»ŠCH Báº¢N: SEEKER Äáº¶T BOOKING VÃ€ THANH TOÃN

## SÆ¡ Ä‘á»“ luá»“ng chÃ­nh

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        SEEKER BOOKING & PAYMENT FLOW                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    ğŸ‘¤ SEEKER                        ğŸ–¥ï¸ SERVER                      ğŸ’³ MOMO
        â”‚                                â”‚                              â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
        â”‚  â”‚ BÆ¯á»šC 1: TÃŒM KIáº¾M EXPERT                                â”‚   â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
        â”‚                                â”‚                              â”‚
        â”‚ GET /expert-search/advanced    â”‚                              â”‚
        â”‚ ?specialties=psychology        â”‚                              â”‚
        â”‚ &price_max=200000              â”‚                              â”‚
        â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                              â”‚
        â”‚                                â”‚                              â”‚
        â”‚    { experts: [...] }          â”‚                              â”‚
        â”‚ <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                              â”‚
        â”‚                                â”‚                              â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
        â”‚  â”‚ BÆ¯á»šC 2: XEM CHI TIáº¾T EXPERT                            â”‚   â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
        â”‚                                â”‚                              â”‚
        â”‚ GET /expert-search/5/full      â”‚                              â”‚
        â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                              â”‚
        â”‚                                â”‚                              â”‚
        â”‚    {                           â”‚                              â”‚
        â”‚      expert: {                 â”‚                              â”‚
        â”‚        id: 5,                  â”‚                              â”‚
        â”‚        name: "Dr. Nguyen",     â”‚                              â”‚
        â”‚        price_per_session:      â”‚                              â”‚
        â”‚          100000,               â”‚                              â”‚
        â”‚        rating: 4.8,            â”‚                              â”‚
        â”‚        availabilities: [...]   â”‚                              â”‚
        â”‚      }                         â”‚                              â”‚
        â”‚    }                           â”‚                              â”‚
        â”‚ <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                              â”‚
        â”‚                                â”‚                              â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
        â”‚  â”‚ BÆ¯á»šC 3: Táº O BOOKING + KHá»I Táº O THANH TOÃN              â”‚   â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
        â”‚                                â”‚                              â”‚
        â”‚ POST /bookings                 â”‚                              â”‚
        â”‚ {                              â”‚                              â”‚
        â”‚   expert_id: 5,                â”‚                              â”‚
        â”‚   start_at: "2025-12-02T10:00",â”‚                              â”‚
        â”‚   end_at: "2025-12-02T11:00",  â”‚                              â”‚
        â”‚   channel: "VIDEO",            â”‚                              â”‚
        â”‚   payment_method: "MOMO"       â”‚                              â”‚
        â”‚ }                              â”‚                              â”‚
        â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                              â”‚
        â”‚                                â”‚                              â”‚
        â”‚                                â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
        â”‚                                â”‚ â”‚ Server xá»­ lÃ½:            â”‚ â”‚
        â”‚                                â”‚ â”‚ 1. Validate thá»i gian    â”‚ â”‚
        â”‚                                â”‚ â”‚ 2. Check expert avail    â”‚ â”‚
        â”‚                                â”‚ â”‚ 3. Check overlap         â”‚ â”‚
        â”‚                                â”‚ â”‚ 4. TÃ­nh giÃ¡ (100,000Ä‘)   â”‚ â”‚
        â”‚                                â”‚ â”‚ 5. Táº¡o booking PENDING   â”‚ â”‚
        â”‚                                â”‚ â”‚ 6. Táº¡o payment_intent    â”‚ â”‚
        â”‚                                â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
        â”‚                                â”‚                              â”‚
        â”‚                                â”‚  POST /v2/gateway/api/create â”‚
        â”‚                                â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
        â”‚                                â”‚                              â”‚
        â”‚                                â”‚    { payUrl, qrCodeUrl }     â”‚
        â”‚                                â”‚ <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
        â”‚                                â”‚                              â”‚
        â”‚    {                           â”‚                              â”‚
        â”‚      booking: {                â”‚                              â”‚
        â”‚        id: 123,                â”‚                              â”‚
        â”‚        status: "PENDING",      â”‚                              â”‚
        â”‚        price: 100000           â”‚                              â”‚
        â”‚      },                        â”‚                              â”‚
        â”‚      payment: {                â”‚                              â”‚
        â”‚        orderId: "BK123_xxx",   â”‚                              â”‚
        â”‚        payUrl: "https://...",  â”‚                              â”‚
        â”‚        qrCodeUrl: "https://..."â”‚                              â”‚
        â”‚      }                         â”‚                              â”‚
        â”‚    }                           â”‚                              â”‚
        â”‚ <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                              â”‚
        â”‚                                â”‚                              â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
        â”‚  â”‚ BÆ¯á»šC 4: SEEKER THANH TOÃN QUA MOMO                     â”‚   â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
        â”‚                                â”‚                              â”‚
        â”‚  Má»Ÿ payUrl trong browser       â”‚                              â”‚
        â”‚  hoáº·c scan QR code             â”‚                              â”‚
        â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
        â”‚                                â”‚                              â”‚
        â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
        â”‚    â”‚  ğŸ“± MOMO APP / WEB                                    â”‚  â”‚
        â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
        â”‚    â”‚  â”‚  Thanh toÃ¡n cho: Healing App                    â”‚  â”‚  â”‚
        â”‚    â”‚  â”‚  Sá»‘ tiá»n: 100,000 VND                           â”‚  â”‚  â”‚
        â”‚    â”‚  â”‚  Ná»™i dung: Booking #123                         â”‚  â”‚  â”‚
        â”‚    â”‚  â”‚                                                 â”‚  â”‚  â”‚
        â”‚    â”‚  â”‚  [XÃ¡c nháº­n thanh toÃ¡n]                          â”‚  â”‚  â”‚
        â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
        â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
        â”‚                                â”‚                              â”‚
        â”‚  Nháº­p PIN / XÃ¡c nháº­n           â”‚                              â”‚
        â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
        â”‚                                â”‚                              â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
        â”‚  â”‚ BÆ¯á»šC 5: MOMO Gá»ŒI IPN CALLBACK                          â”‚   â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
        â”‚                                â”‚                              â”‚
        â”‚                                â”‚  POST /api/v1/payments/      â”‚
        â”‚                                â”‚       momo/ipn               â”‚
        â”‚                                â”‚  {                           â”‚
        â”‚                                â”‚    orderId: "BK123_xxx",     â”‚
        â”‚                                â”‚    resultCode: 0,            â”‚
        â”‚                                â”‚    transId: "MOMO_xxx",      â”‚
        â”‚                                â”‚    amount: 100000            â”‚
        â”‚                                â”‚  }                           â”‚
        â”‚                                â”‚ <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
        â”‚                                â”‚                              â”‚
        â”‚                                â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
        â”‚                                â”‚ â”‚ Server xá»­ lÃ½:            â”‚ â”‚
        â”‚                                â”‚ â”‚ 1. Verify signature      â”‚ â”‚
        â”‚                                â”‚ â”‚ 2. Update payment PAID   â”‚ â”‚
        â”‚                                â”‚ â”‚ 3. Update booking        â”‚ â”‚
        â”‚                                â”‚ â”‚    CONFIRMED             â”‚ â”‚
        â”‚                                â”‚ â”‚ 4. Táº¡o chat thread       â”‚ â”‚
        â”‚                                â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
        â”‚                                â”‚                              â”‚
        â”‚                                â”‚    { ok: true }              â”‚
        â”‚                                â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
        â”‚                                â”‚                              â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
        â”‚  â”‚ BÆ¯á»šC 6: REDIRECT Vá»€ APP                                â”‚   â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
        â”‚                                â”‚                              â”‚
        â”‚    Redirect to:                â”‚                              â”‚
        â”‚    /payment/result?            â”‚                              â”‚
        â”‚    orderId=BK123_xxx&          â”‚                              â”‚
        â”‚    resultCode=0                â”‚                              â”‚
        â”‚ <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
        â”‚                                â”‚                              â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
        â”‚  â”‚ BÆ¯á»šC 7: XEM BOOKING ÄÃƒ CONFIRMED                       â”‚   â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
        â”‚                                â”‚                              â”‚
        â”‚ GET /bookings/123              â”‚                              â”‚
        â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                              â”‚
        â”‚                                â”‚                              â”‚
        â”‚    {                           â”‚                              â”‚
        â”‚      booking: {                â”‚                              â”‚
        â”‚        id: 123,                â”‚                              â”‚
        â”‚        status: "CONFIRMED",    â”‚  âœ… ÄÃƒ XÃC NHáº¬N             â”‚
        â”‚        price: 100000           â”‚                              â”‚
        â”‚      },                        â”‚                              â”‚
        â”‚      payment: {                â”‚                              â”‚
        â”‚        status: "PAID"          â”‚  âœ… ÄÃƒ THANH TOÃN           â”‚
        â”‚      },                        â”‚                              â”‚
        â”‚      fees: {                   â”‚                              â”‚
        â”‚        gross: 100000,          â”‚                              â”‚
        â”‚        platform_fee: 15000,    â”‚  (15%)                       â”‚
        â”‚        expert_earning: 85000   â”‚  (Expert sáº½ nháº­n)            â”‚
        â”‚      }                         â”‚                              â”‚
        â”‚    }                           â”‚                              â”‚
        â”‚ <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                              â”‚
        â”‚                                â”‚                              â”‚
        â–¼                                â–¼                              â–¼
```


## Database State Changes

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           DATABASE STATE CHANGES                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  ğŸ“¦ app.bookings                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚ id     â”‚ user_id â”‚ expert_id â”‚ price    â”‚ status        â”‚                   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                   â”‚
â”‚  â”‚ 123    â”‚ 10      â”‚ 5         â”‚ 100000   â”‚ PENDING       â”‚ â† BÆ°á»›c 3          â”‚
â”‚  â”‚ 123    â”‚ 10      â”‚ 5         â”‚ 100000   â”‚ CONFIRMED     â”‚ â† BÆ°á»›c 5          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                                                                 â”‚
â”‚  ğŸ’³ app.payment_intents                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚  â”‚ id     â”‚ booking_id â”‚ amount   â”‚ status            â”‚                        â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                        â”‚
â”‚  â”‚ 456    â”‚ 123        â”‚ 100000   â”‚ REQUIRES_ACTION   â”‚ â† BÆ°á»›c 3               â”‚
â”‚  â”‚ 456    â”‚ 123        â”‚ 100000   â”‚ PAID              â”‚ â† BÆ°á»›c 5               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                                                                                 â”‚
â”‚  ğŸ’¬ app.chat_threads (táº¡o sau khi CONFIRMED)                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚  â”‚ id     â”‚ booking_id â”‚ type                           â”‚                      â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                      â”‚
â”‚  â”‚ 789    â”‚ 123        â”‚ BOOKING                        â”‚ â† BÆ°á»›c 5             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Sau khi Booking hoÃ n thÃ nh

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        SAU KHI BOOKING HOÃ€N THÃ€NH                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  ğŸ‘¤ SEEKER hoáº·c ğŸ‘¨â€âš•ï¸ EXPERT                                                      â”‚
â”‚        â”‚                                                                        â”‚
â”‚        â”‚ PATCH /bookings/123/complete                                           â”‚
â”‚        â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>                                        â”‚
â”‚        â”‚                                                                        â”‚
â”‚        â”‚                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚        â”‚                                â”‚ Server xá»­ lÃ½:            â”‚            â”‚
â”‚        â”‚                                â”‚ 1. Update COMPLETED      â”‚            â”‚
â”‚        â”‚                                â”‚ 2. TÃ­nh platform fee     â”‚            â”‚
â”‚        â”‚                                â”‚    - Gross: 100,000      â”‚            â”‚
â”‚        â”‚                                â”‚    - Fee 15%: 15,000     â”‚            â”‚
â”‚        â”‚                                â”‚    - Expert: 85,000      â”‚            â”‚
â”‚        â”‚                                â”‚ 3. Credit wallet expert  â”‚            â”‚
â”‚        â”‚                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚        â”‚                                                                        â”‚
â”‚  ğŸ‘› app.wallets (Expert ID: 5)                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                     â”‚
â”‚  â”‚ id     â”‚ owner_user_id â”‚ balance      â”‚                                     â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                     â”‚
â”‚  â”‚ 1      â”‚ 5             â”‚ 85,000 VND   â”‚ â† Expert nháº­n tiá»n                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                     â”‚
â”‚                                                                                 â”‚
â”‚  ğŸ“Š app.booking_fees                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚ booking_id â”‚ gross_amount â”‚ platform_fee â”‚ expert_earning â”‚                 â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                 â”‚
â”‚  â”‚ 123        â”‚ 100,000      â”‚ 15,000       â”‚ 85,000         â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“‹ TÃ“M Táº®T CÃC BÆ¯á»šC

| BÆ°á»›c | HÃ nh Ä‘á»™ng | API | Káº¿t quáº£ |
|------|-----------|-----|---------|
| 1 | TÃ¬m expert | `GET /expert-search/advanced` | Danh sÃ¡ch expert |
| 2 | Xem chi tiáº¿t | `GET /expert-search/:id/full` | ThÃ´ng tin + giÃ¡ + lá»‹ch ráº£nh |
| 3 | Táº¡o booking | `POST /bookings` | Booking PENDING + payUrl MoMo |
| 4 | Thanh toÃ¡n | Má»Ÿ payUrl | Seeker tráº£ tiá»n qua MoMo |
| 5 | IPN callback | `POST /payments/momo/ipn` | Booking CONFIRMED |
| 6 | Redirect | - | Seeker quay láº¡i app |
| 7 | HoÃ n thÃ nh | `PATCH /bookings/:id/complete` | Expert nháº­n 85% vÃ o wallet |

---

## ğŸ”„ BOOKING STATUS FLOW

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   PENDING   â”‚ â† Táº¡o booking, chá» thanh toÃ¡n
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚               â”‚               â”‚
           â–¼               â–¼               â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  CONFIRMED  â”‚ â”‚  CANCELLED  â”‚ â”‚   EXPIRED   â”‚
    â”‚ (ÄÃ£ TT)     â”‚ â”‚ (User há»§y)  â”‚ â”‚ (Háº¿t háº¡n)   â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ Sau buá»•i tÆ° váº¥n
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  COMPLETED  â”‚ â† Expert nháº­n tiá»n vÃ o wallet
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’° PAYMENT STATUS FLOW

```
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚    INIT     â”‚ â† Khá»Ÿi táº¡o
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ REQUIRES_ACTION â”‚ â† Chá» user thanh toÃ¡n
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚        â”‚        â”‚
    â–¼        â–¼        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PAID â”‚ â”‚FAILEDâ”‚ â”‚ EXPIRED â”‚
â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ API ENDPOINTS CHI TIáº¾T

### 1. Táº¡o Booking vá»›i Payment

**Request:**
```http
POST /api/v1/bookings
Authorization: Bearer <seeker_token>
Content-Type: application/json

{
  "expert_id": 5,
  "start_at": "2025-12-02T10:00:00.000Z",
  "end_at": "2025-12-02T11:00:00.000Z",
  "channel": "VIDEO",
  "payment_method": "MOMO",
  "initiate_payment": true
}
```

**Response:**
```json
{
  "success": true,
  "message": "bookings.create.paymentInitiated",
  "data": {
    "booking": {
      "id": 123,
      "user_id": 10,
      "expert_id": 5,
      "start_at": "2025-12-02T10:00:00.000Z",
      "end_at": "2025-12-02T11:00:00.000Z",
      "channel": "VIDEO",
      "price": 100000,
      "status": "PENDING"
    },
    "payment": {
      "intent_id": 456,
      "orderId": "BK123_1701432000000",
      "requestId": "REQ_1701432000000_10",
      "resultCode": 0,
      "message": "Success",
      "payUrl": "https://test-payment.momo.vn/v2/gateway/pay?t=xxx",
      "qrCodeUrl": "https://test-payment.momo.vn/v2/gateway/qr?xxx"
    },
    "nextAction": "COMPLETE_PAYMENT"
  }
}
```

### 2. Xem Chi tiáº¿t Booking

**Request:**
```http
GET /api/v1/bookings/123
Authorization: Bearer <token>
```

**Response:**
```json
{
  "success": true,
  "data": {
    "booking": {
      "id": 123,
      "user_id": 10,
      "expert_id": 5,
      "start_at": "2025-12-02T10:00:00.000Z",
      "end_at": "2025-12-02T11:00:00.000Z",
      "channel": "VIDEO",
      "price": 100000,
      "status": "CONFIRMED"
    },
    "payment": {
      "id": 456,
      "status": "PAID",
      "amount": 100000,
      "provider": "MOMO"
    },
    "fees": {
      "gross_amount": 100000,
      "platform_fee": 15000,
      "platform_fee_percent": 15,
      "expert_earning": 85000
    }
  }
}
```

### 3. Há»§y Booking (vá»›i Refund)

**Request:**
```http
PATCH /api/v1/bookings/123/cancel
Authorization: Bearer <token>
Content-Type: application/json

{
  "reason": "TÃ´i cÃ³ viá»‡c báº­n Ä‘á»™t xuáº¥t"
}
```

**Response:**
```json
{
  "success": true,
  "data": {
    "booking": {
      "id": 123,
      "status": "CANCELLED"
    },
    "refund": {
      "refundId": 789,
      "refundType": "FULL",
      "refundAmount": 100000,
      "originalAmount": 100000
    },
    "cancelledBy": "SEEKER"
  }
}
```

---

## âš™ï¸ CHÃNH SÃCH HOÃ€N TIá»€N

| Thá»i Ä‘iá»ƒm há»§y | % HoÃ n tiá»n | VÃ­ dá»¥ (100,000Ä‘) |
|---------------|-------------|------------------|
| >= 24h trÆ°á»›c booking | 100% | 100,000Ä‘ |
| < 24h trÆ°á»›c booking | 50% | 50,000Ä‘ |
| ÄÃ£ báº¯t Ä‘áº§u | 0% | 0Ä‘ |
| Expert há»§y | 100% | 100,000Ä‘ (luÃ´n hoÃ n Ä‘á»§) |

---

## ğŸ§ª TEST SCENARIOS

### Scenario 1: Happy Path
1. Seeker táº¡o booking â†’ PENDING
2. Seeker thanh toÃ¡n MoMo â†’ CONFIRMED
3. Buá»•i tÆ° váº¥n diá»…n ra
4. Complete booking â†’ Expert nháº­n 85,000Ä‘

### Scenario 2: Seeker há»§y trÆ°á»›c 24h
1. Seeker táº¡o booking â†’ PENDING
2. Seeker thanh toÃ¡n â†’ CONFIRMED
3. Seeker há»§y (trÆ°á»›c 24h) â†’ CANCELLED
4. Seeker nháº­n hoÃ n 100,000Ä‘ vÃ o wallet

### Scenario 3: Payment timeout
1. Seeker táº¡o booking â†’ PENDING
2. KhÃ´ng thanh toÃ¡n trong 15 phÃºt
3. Há»‡ thá»‘ng tá»± Ä‘á»™ng â†’ CANCELLED

### Scenario 4: Expert há»§y
1. Booking CONFIRMED
2. Expert há»§y â†’ CANCELLED
3. Seeker nháº­n hoÃ n 100% (100,000Ä‘)
